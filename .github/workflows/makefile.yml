name: Makefile CI

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    
    - name: Install GoogleTest
      run:  sudo apt-get update -y && \
            sudo apt-get install -y libgtest-dev valgrind cmake clang-tidy-8 expect && \
            sudo wget https://github.com/google/googletest/archive/release-1.10.0.tar.gz && \
            sudo tar xf release-1.10.0.tar.gz && \
            cd googletest-release-1.10.0 && \
            sudo mkdir build; cd build && \
            sudo cmake -DBUILD_SHARED_LIBS=ON -DBUILD_GMOCK=OFF .. && \
            sudo make && \
            sudo make install
      
    - name: Install dependencies
      run: make
